{% extends 'Sandbox/Adapter/base_adapter.html.twig' %}

{% block javascripts %}
	{{ parent() }}

	<script type="text/javascript">
		$(function() {
			set_active_host('local');

			$('#realex-form').submit(function(e) {
				set_active_host('remote');
			});
		});
	</script>
{% endblock %}

{% set merchant_id = 'MERCHANT_ID' %}
{% set order_id = 'ORDER_ID' %}

{% block local %}
	<div class="alert alert-info">
		In your application, all of the following inputs should be hidden elements. The form will post to the Realex API, or
		to a FakePay instance if in development.
	</div>

    <form id="realex-form" target="realex-iframe" method="post" action="{{ path('sandbox_request', {adapter: adapter.name}) }}">
        <fieldset>
            <legend>required fields</legend>

			<input id="realex-secret" type="hidden" value="{{ app.fakepay.adapter.realex.secret }}" />

            <label>MERCHANT_ID</label>
            <input id="realex-merchant" type="text" name="MERCHANT_ID" value="{{ app.fakepay.adapter.realex.merchant_id }}" />

            <label>ORDER_ID</label>
            <input id="realex-order" type="text" name="ORDER_ID" value="xyz" />

            <label>AMOUNT</label>
            <input id="realex-amount" type="text" name="AMOUNT" value="1000" />

            <label>CURRENCY</label>
            <input id="realex-currency" type="text" name="CURRENCY" value="USD" />

            <label>TIMESTAMP</label>
            <input id="realex-timestamp" type="text" name="TIMESTAMP" value="{{ 'now'|date('Ymdhis') }}" />

            <label>AUTO_SETTLE_FLAG</label>
            <input type="text" name="AUTO_SETTLE_FLAG" value="1" />

        </fieldset>

        <fieldset>
            <legend>MD5 or SHA1 hash</legend>

			<div class="alert alert-info">
				<span class="help-block">
					Generated by concatenating the following values with full stops: (minus spaces)
				</span>
				<span class="help-block">
					hash(hash(TIMESTAMP . MERCHANT_ID . ORDER_ID . AMOUNT . CURRENCY . PAYER_REF . PMT_REF) . SECRET)
				</span>
			</div>

			<label>MD5_HASH</label>
			<input type="text" name="MD5_HASH" value="{{ 'XXX'|md5 }}" />

			<label>SHA1_HASH</label>
			<input type="text" name="SHA1_HASH" value="{{ 'XXX'|sha1 }}" />
		</fieldset>

        <fieldset>
            <legend>optional fields</legend>

			<label class="checkbox">
				<input type="checkbox" name="OFFER_SAVE_CARD" value="1" /> OFFER_SAVE_CARD
			</label>

			<label>PAYER_REF</label>
			<input id="realex-payer" type="text" name="PAYER_REF" value="abcd" />
			<span class="help-inline">(required if OFFER_SAVE_CARD = 1)</span>

			<label>PMT_REF</label>
			<input id="realex-pmt" type="text" name="PMT_REF" value="efgh" />
			<span class="help-inline">(required if OFFER_SAVE_CARD = 1)</span>

			<label>PAYER_EXIST</label>
			<input id="realex-exist" type="text" name="PAYER_EXIST" value="1" />
			<span class="help-inline">(required if OFFER_SAVE_CARD = 1)</span>

        </fieldset>

		<div class="form-actions">
        	<input type="submit" value="submit" class="btn btn-primary" />
		</div>
    </form>
{% endblock %}

{% block remote %}
    <iframe name="realex-iframe" id="remote-frame"></iframe>
{% endblock %}